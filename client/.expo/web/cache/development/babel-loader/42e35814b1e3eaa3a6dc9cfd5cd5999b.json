{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"C:\\\\APPS\\\\DOMA_EVID\\\\ReactNative\\\\frontend\\\\app\\\\screens\\\\ArtikalEditScreen.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useState } from \"react\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Switch from \"react-native-web/dist/exports/Switch\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport * as Yup from \"yup\";\nimport { Form, FormField, FormPicker as Picker, SubmitButton } from \"../components/forms\";\nimport CategoryPickerItem from \"../components/CategoryPickerItem\";\nimport defaultStyles from \"../config/styles\";\nimport Screen from \"../components/Screen\";\nimport FormImagePicker from \"../components/forms/FormImagePicker\";\nimport artikalsApi from \"../api/artikals\";\nimport vidsApi from \"../api/vids\";\nimport UploadScreen from \"./UploadScreen\";\nvar validationSchema = Yup.object().shape({\n  artikal_id: Yup.string().label(\"ID\"),\n  ime_artikal: Yup.string().required().min(1).label(\"Ime na Artikal\"),\n  cena: Yup.number().required().min(1).max(10000).label(\"Cena\"),\n  steuerrelevant: Yup.string().label(\"Steuerrelevant\"),\n  vid: Yup.object().required(\"Vid e obavezno da se vnese\").nullable().label(\"artikal.ime_vid\")\n});\n\nfunction ArtikalEditScreen(_ref) {\n  var route = _ref.route;\n  console.log(\"START ArtikalEditScreen\");\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      vidData = _useState2[0],\n      setVidData = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      uploadVisible = _useState4[0],\n      setUploadVisible = _useState4[1];\n\n  var _useState5 = useState(0),\n      _useState6 = _slicedToArray(_useState5, 2),\n      progress = _useState6[0],\n      setProgress = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      loading = _useState8[0],\n      setLoading = _useState8[1];\n\n  var _useState9 = useState(false),\n      _useState10 = _slicedToArray(_useState9, 2),\n      error = _useState10[0],\n      setError = _useState10[1];\n\n  var _useState11 = useState(false),\n      _useState12 = _slicedToArray(_useState11, 2),\n      isEnabled = _useState12[0],\n      setIsEnabled = _useState12[1];\n\n  var toggleSwitch = function toggleSwitch() {\n    return setIsEnabled(function (previousState) {\n      if (!isAddMode) {\n        previousState ? artikal.steuerrelevant = 1 : artikal.steuerrelevant = 0;\n      }\n\n      return !previousState;\n    });\n  };\n\n  var isAddMode = true;\n  var artikal = route.params;\n\n  if (artikal !== undefined) {\n    var id = route.params.artikal_id.id;\n    console.log(\"id = \" + id);\n    isAddMode = !artikal.artikal_id;\n    console.log(\"isAddMode = \" + isAddMode);\n    console.log(\"artikal.artikal_id = \" + artikal.artikal_id);\n    console.log(\"artikal.cena = \" + artikal.cena);\n    console.log(\"artikal.vid_id = \" + artikal.vid_id);\n  } else {}\n\n  useEffect(function () {\n    console.log(\"START *********** useEffect ***********\");\n    getAllVids();\n\n    if (route.params) {\n      artikal.steuerrelevant ? setIsEnabled(true) : setIsEnabled(false);\n      console.log(\"setImeArtikal\");\n    }\n\n    console.log(\"END ************ useEffect ************\");\n  }, []);\n\n  var getAllVids = function getAllVids() {\n    var response;\n    return _regeneratorRuntime.async(function getAllVids$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            console.log(\"START getAllVids-1\");\n            setLoading(true);\n            _context.next = 4;\n            return _regeneratorRuntime.awrap(vidsApi.getVids());\n\n          case 4:\n            response = _context.sent;\n            setLoading(false);\n            setError(!response.ok);\n            setVidData(response.data);\n            console.log(\"END getAllVids-1\");\n            return _context.abrupt(\"return\", response);\n\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var handleSubmit = function handleSubmit(artikal2, _ref2) {\n    var resetForm, result;\n    return _regeneratorRuntime.async(function handleSubmit$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            resetForm = _ref2.resetForm;\n            console.log(\"START handleSubmit\");\n            console.log(\"1. artikal2 = \" + JSON.stringify(artikal2, null, 2));\n            console.log(\"2. artikal2.vid_id = \" + artikal2.vid_id);\n            console.log(\"3. artikal2 = \" + JSON.stringify(artikal2, null, 2));\n            isEnabled ? artikal2.steuerrelevant = 1 : artikal2.steuerrelevant = 0;\n            console.log(\"4. artikal2.steuerrelevant = \" + artikal2.steuerrelevant);\n            setProgress(0);\n            setUploadVisible(true);\n            console.log(\"\");\n\n            if (!isAddMode) {\n              _context2.next = 16;\n              break;\n            }\n\n            _context2.next = 13;\n            return _regeneratorRuntime.awrap(artikalsApi.addArtikal(_objectSpread({}, artikal2), function (progress) {\n              return setProgress(progress);\n            }));\n\n          case 13:\n            result = _context2.sent;\n            _context2.next = 19;\n            break;\n\n          case 16:\n            _context2.next = 18;\n            return _regeneratorRuntime.awrap(artikalsApi.updateArtikal(_objectSpread({}, artikal2), function (progress) {\n              return setProgress(progress);\n            }));\n\n          case 18:\n            result = _context2.sent;\n\n          case 19:\n            if (result.ok) {\n              _context2.next = 22;\n              break;\n            }\n\n            setUploadVisible(false);\n            return _context2.abrupt(\"return\", alert(\"Could not save the artikal\"));\n\n          case 22:\n            if (isAddMode) {\n              resetForm();\n              setIsEnabled(false);\n            }\n\n            console.log(\"END handleSubmit\");\n\n          case 24:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var getImeArtikal = function getImeArtikal() {\n    console.log(\"START getImeArtikal\");\n\n    if (isAddMode) {\n      console.log(\"IME_ARTIKAL = <>\");\n      return \"\";\n    } else {\n      console.log(\"IME_ARTIKAL mora da bide popolneto\");\n      console.log(\"artikal.artikal_id = \" + artikal.artikal_id);\n      console.log(\"END getImeArtikal\");\n      return artikal.ime_artikal;\n    }\n  };\n\n  var getVidId = function getVidId() {\n    console.log(\"---> START getVidId\");\n\n    if (vidData.length < 1) {\n      console.log(\"     vidData is empty data\");\n      return \"Prazen Vid\";\n    } else {\n      console.log(\"     vidData has data\");\n    }\n\n    if (isAddMode) {\n      console.log(\"     VID_ID = <>\");\n      return \"Prazen Vid\";\n    } else {\n      console.log(\"     VID_ID mora da bide popolneto\");\n      console.log(\"     artikal.vid_id = \" + artikal.vid_id);\n      var imeVid = vidData.filter(function (item) {\n        return item.value === artikal.vid_id;\n      });\n      console.log(\"     imeVid = \" + JSON.stringify(imeVid, null, 2));\n      console.log(\"imeVid.label = \" + imeVid[0].label);\n      console.log(\"<--- END getVidId\");\n      return imeVid[0].label;\n    }\n  };\n\n  function convertUTCDateToLocalDate(date) {\n    var newDate = new Date(date.getTime() + date.getTimezoneOffset() * 60 * 1000);\n    var offset = date.getTimezoneOffset() / 60;\n    var hours = date.getHours();\n    newDate.setHours(hours - offset);\n    return newDate;\n  }\n\n  return React.createElement(Screen, {\n    style: styles.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 5\n    }\n  }, React.createElement(UploadScreen, {\n    onDone: function onDone() {\n      return setUploadVisible(false);\n    },\n    progress: progress,\n    visible: uploadVisible,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 7\n    }\n  }), React.createElement(Form, {\n    initialValues: {\n      artikal_id: isAddMode ? \"\" : artikal.artikal_id.toString(),\n      ime_artikal: isAddMode ? \"\" : getImeArtikal(),\n      cena: isAddMode ? \"\" : artikal.cena.toString(),\n      steuerrelevant: isAddMode ? \"0\" : artikal.steuerrelevant.toString(),\n      vid: {\n        label: isAddMode ? \"Vnesi Vid\" : artikal.ime_vid.toString(),\n        value: isAddMode ? \"\" : artikal.vid_id\n      },\n      vid2: isAddMode ? \"\" : artikal.ime_vid,\n      insdate: isAddMode ? \"\" : convertUTCDateToLocalDate(new Date(artikal.insdate)).toString()\n    },\n    onSubmit: handleSubmit,\n    validationSchema: validationSchema,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 7\n    }\n  }, React.createElement(FormField, {\n    maxLength: 255,\n    name: \"ime_artikal\",\n    placeholder: \"Ime na Artikal\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 9\n    }\n  }), React.createElement(FormField, {\n    maxLength: 255,\n    name: \"vid2\",\n    placeholder: \"Vid2\",\n    width: \"100%\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 9\n    }\n  }), React.createElement(FormField, {\n    keyboardType: \"numeric\",\n    maxLength: 8,\n    name: \"cena\",\n    placeholder: \"Cena\",\n    width: 120,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 9\n    }\n  }), React.createElement(Picker, {\n    items: vidData,\n    name: \"vid\",\n    numberOfColumns: 3,\n    PickerItemComponent: CategoryPickerItem,\n    placeholder: \"Vid\",\n    width: \"100%\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 279,\n      columnNumber: 9\n    }\n  }), React.createElement(Text, {\n    style: styles.switch,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 291,\n      columnNumber: 9\n    }\n  }, React.createElement(Switch, {\n    style: styles.switch,\n    trackColor: {\n      false: \"#767577\",\n      true: \"#81b0ff\"\n    },\n    thumbColor: isEnabled ? \"#f5dd4b\" : \"#f4f3f4\",\n    ios_backgroundColor: \"#3e3e3e\",\n    onValueChange: toggleSwitch,\n    value: isEnabled,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 292,\n      columnNumber: 11\n    }\n  }), \"Danok\"), React.createElement(FormField, {\n    keyboardType: \"numeric\",\n    maxLength: 8,\n    name: \"steuerrelevant\",\n    placeholder: \"Danok?\",\n    width: 120,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 304,\n      columnNumber: 9\n    }\n  }), React.createElement(FormField, {\n    keyboardType: \"numeric\",\n    maxLength: 10,\n    name: \"insdate\",\n    placeholder: \"Datum na vnes\",\n    width: \"100%\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 312,\n      columnNumber: 9\n    }\n  }), React.createElement(SubmitButton, {\n    title: \"Save\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 319,\n      columnNumber: 9\n    }\n  })));\n}\n\nvar styles = StyleSheet.create({\n  container: {\n    padding: 10\n  },\n  switch: {\n    backgroundColor: defaultStyles.colors.light,\n    borderRadius: 25,\n    flexDirection: \"row\",\n    padding: 15,\n    marginVertical: 10,\n    alignItems: \"stretch\"\n  }\n});\nexport default ArtikalEditScreen;","map":{"version":3,"sources":["C:/APPS/DOMA_EVID/ReactNative/frontend/app/screens/ArtikalEditScreen.js"],"names":["React","useEffect","useState","Yup","Form","FormField","FormPicker","Picker","SubmitButton","CategoryPickerItem","defaultStyles","Screen","FormImagePicker","artikalsApi","vidsApi","UploadScreen","validationSchema","object","shape","artikal_id","string","label","ime_artikal","required","min","cena","number","max","steuerrelevant","vid","nullable","ArtikalEditScreen","route","console","log","vidData","setVidData","uploadVisible","setUploadVisible","progress","setProgress","loading","setLoading","error","setError","isEnabled","setIsEnabled","toggleSwitch","previousState","isAddMode","artikal","params","undefined","id","vid_id","getAllVids","getVids","response","ok","data","handleSubmit","artikal2","resetForm","JSON","stringify","addArtikal","result","updateArtikal","alert","getImeArtikal","getVidId","length","imeVid","filter","item","value","convertUTCDateToLocalDate","date","newDate","Date","getTime","getTimezoneOffset","offset","hours","getHours","setHours","styles","container","toString","ime_vid","vid2","insdate","switch","false","true","StyleSheet","create","padding","backgroundColor","colors","light","borderRadius","flexDirection","marginVertical","alignItems"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { StyleSheet, Switch, Text } from \"react-native\";\nimport * as Yup from \"yup\";\n\nimport {\n  Form,\n  FormField,\n  FormPicker as Picker,\n  SubmitButton,\n} from \"../components/forms\";\nimport CategoryPickerItem from \"../components/CategoryPickerItem\";\nimport defaultStyles from \"../config/styles\";\nimport Screen from \"../components/Screen\";\nimport FormImagePicker from \"../components/forms/FormImagePicker\";\nimport artikalsApi from \"../api/artikals\";\nimport vidsApi from \"../api/vids\";\n// import useLocation from \"../hooks/useLocation\";\nimport UploadScreen from \"./UploadScreen\";\n\nconst validationSchema = Yup.object().shape({\n  artikal_id: Yup.string().label(\"ID\"),\n  ime_artikal: Yup.string().required().min(1).label(\"Ime na Artikal\"),\n  cena: Yup.number().required().min(1).max(10000).label(\"Cena\"),\n  steuerrelevant: Yup.string().label(\"Steuerrelevant\"),\n  // vid_id: Yup.number().required().min(1).max(10000).label(\"Vid\"),\n  // vid: Yup.string().required().min(1).label(\"Vid\"),\n  // vid: Yup.object().required().nullable().label(\"Vid\"),\n  vid: Yup.object()\n    .required(\"Vid e obavezno da se vnese\")\n    .nullable()\n    .label(\"artikal.ime_vid\"),\n  // images: Yup.array().min(1, \"Please select at least one image.\"),\n});\n\nfunction ArtikalEditScreen({ route }) {\n  console.log(\"START ArtikalEditScreen\");\n\n  // const [imeArtikal, setImeArtikal] = useState(\"\");\n  // const [idArtikal, setIdArtikal] = useState(artikal.artikal_id);\n\n  // const location = useLocation();\n  const [vidData, setVidData] = useState([]);\n  const [uploadVisible, setUploadVisible] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(false);\n  const [isEnabled, setIsEnabled] = useState(false);\n\n  const toggleSwitch = () =>\n    setIsEnabled((previousState) => {\n      if (!isAddMode) {\n        previousState\n          ? (artikal.steuerrelevant = 1)\n          : (artikal.steuerrelevant = 0);\n      }\n      return !previousState;\n    });\n\n  let isAddMode = true;\n  const artikal = route.params;\n  if (artikal !== undefined) {\n    const { id } = route.params.artikal_id;\n\n    // console.log(\"artikal = \" + JSON.stringify(artikal, null, 2));\n    // console.log(\"artikal.ime_artikal = \" + artikal.ime_artikal);\n    console.log(\"id = \" + id);\n\n    isAddMode = !artikal.artikal_id;\n    // setIdArtikal(artikal.artikal_id);\n    console.log(\"isAddMode = \" + isAddMode);\n    console.log(\"artikal.artikal_id = \" + artikal.artikal_id);\n    console.log(\"artikal.cena = \" + artikal.cena);\n    console.log(\"artikal.vid_id = \" + artikal.vid_id);\n  } else {\n    // setIsEnabled(false);\n  }\n\n  useEffect(() => {\n    console.log(\"START *********** useEffect ***********\");\n\n    getAllVids();\n\n    if (route.params) {\n      artikal.steuerrelevant ? setIsEnabled(true) : setIsEnabled(false);\n      console.log(\"setImeArtikal\");\n      // setImeArtikal(artikal.ime_artikal);\n    }\n\n    console.log(\"END ************ useEffect ************\");\n  }, []);\n\n  const getAllVids = async () => {\n    console.log(\"START getAllVids-1\");\n\n    setLoading(true);\n    const response = await vidsApi.getVids();\n    setLoading(false);\n\n    setError(!response.ok);\n\n    // console.log(\"5. vidData: \" + JSON.stringify(response.data));\n    setVidData(response.data);\n    // console.log(\"6. response.data: \" + JSON.stringify(response.data[0]));\n    // console.log(\"7. response.data: \" + JSON.stringify(response.data, null, 2));\n    // console.log(\"8. vidData: \" + JSON.stringify(vidData, null, 2));\n\n    console.log(\"END getAllVids-1\");\n    return response;\n  };\n\n  const handleSubmit = async (artikal2, { resetForm }) => {\n    console.log(\"START handleSubmit\");\n\n    console.log(\"1. artikal2 = \" + JSON.stringify(artikal2, null, 2));\n    // artikal2.artikal_id = artikal.artikal_id;\n    // artikal2.vid_id = artikal.vid_id;\n    console.log(\"2. artikal2.vid_id = \" + artikal2.vid_id);\n    // console.log(\"idArtikal = \" + idArtikal);\n    // console.log(\"id = \" + id);\n    console.log(\"3. artikal2 = \" + JSON.stringify(artikal2, null, 2));\n\n    isEnabled ? (artikal2.steuerrelevant = 1) : (artikal2.steuerrelevant = 0);\n    console.log(\"4. artikal2.steuerrelevant = \" + artikal2.steuerrelevant);\n\n    setProgress(0);\n    setUploadVisible(true);\n    console.log(\"\");\n\n    var result;\n\n    if (isAddMode) {\n      result = await artikalsApi.addArtikal({ ...artikal2 }, (progress) =>\n        setProgress(progress)\n      );\n    } else {\n      result = await artikalsApi.updateArtikal({ ...artikal2 }, (progress) =>\n        setProgress(progress)\n      );\n    }\n\n    if (!result.ok) {\n      setUploadVisible(false);\n      return alert(\"Could not save the artikal\");\n    }\n\n    if (isAddMode) {\n      resetForm();\n      setIsEnabled(false);\n    } //-DT-20210203: Causes the changed field name to get the old value again\n\n    console.log(\"END handleSubmit\");\n  };\n\n  const getImeArtikal = () => {\n    console.log(\"START getImeArtikal\");\n\n    // return artikal.ime_artikal;\n    if (isAddMode) {\n      console.log(\"IME_ARTIKAL = <>\");\n\n      return \"\";\n    } else {\n      console.log(\"IME_ARTIKAL mora da bide popolneto\");\n      console.log(\"artikal.artikal_id = \" + artikal.artikal_id);\n      console.log(\"END getImeArtikal\");\n      return artikal.ime_artikal;\n    }\n  };\n\n  const getVidId = () => {\n    console.log(\"---> START getVidId\");\n\n    // Infinite loops\n    // if (vidData.length < 1) {\n    //   getAllVids();\n    // }\n    // Infinite loops\n\n    // console.log(\"     vidData: \" + JSON.stringify(vidData, null, 2));\n    if (vidData.length < 1) {\n      console.log(\"     vidData is empty data\");\n      return \"Prazen Vid\";\n    } else {\n      console.log(\"     vidData has data\");\n    }\n    if (isAddMode) {\n      console.log(\"     VID_ID = <>\");\n      return \"Prazen Vid\";\n    } else {\n      console.log(\"     VID_ID mora da bide popolneto\");\n      console.log(\"     artikal.vid_id = \" + artikal.vid_id);\n      var imeVid = vidData.filter(function (item) {\n        return item.value === artikal.vid_id;\n      });\n      console.log(\"     imeVid = \" + JSON.stringify(imeVid, null, 2));\n      console.log(\"imeVid.label = \" + imeVid[0].label);\n      console.log(\"<--- END getVidId\");\n      return imeVid[0].label;\n    }\n  };\n\n  function convertUTCDateToLocalDate(date) {\n    var newDate = new Date(\n      date.getTime() + date.getTimezoneOffset() * 60 * 1000\n    );\n\n    var offset = date.getTimezoneOffset() / 60;\n    var hours = date.getHours();\n\n    newDate.setHours(hours - offset);\n\n    return newDate;\n  }\n\n  return (\n    <Screen style={styles.container}>\n      <UploadScreen\n        onDone={() => setUploadVisible(false)}\n        progress={progress}\n        visible={uploadVisible}\n      />\n      <Form\n        initialValues={{\n          artikal_id: isAddMode ? \"\" : artikal.artikal_id.toString(),\n          ime_artikal: isAddMode ? \"\" : getImeArtikal(),\n          // ime_artikal: isAddMode ? \"\" : \"abc123\",\n          cena: isAddMode ? \"\" : artikal.cena.toString(),\n          steuerrelevant: isAddMode ? \"0\" : artikal.steuerrelevant.toString(),\n          // vid_id: null,\n          // vid: isAddMode ? \"\" : artikal.ime_vid},\n          // vid: \"Alkohol\",\n          // vid: selectedItem.label,\n          // vid: vidData.label,\n          // vid: artikal.ime_vid,\n          vid: {\n            label: isAddMode ? \"Vnesi Vid\" : artikal.ime_vid.toString(),\n            // value: isAddMode ? \"\" : artikal.vid_id.toString(),\n            value: isAddMode ? \"\" : artikal.vid_id,\n          },\n          vid2: isAddMode ? \"\" : artikal.ime_vid,\n          insdate: isAddMode\n            ? \"\"\n            : convertUTCDateToLocalDate(new Date(artikal.insdate)).toString(),\n          // images: [],\n        }}\n        onSubmit={handleSubmit}\n        validationSchema={validationSchema}\n      >\n        {/* <FormImagePicker name=\"images\" /> */}\n        <FormField\n          // defaultValue={getImeArtikal()}\n          // defaultValue=\"aaa123\"\n          // isAddMode={isAddMode}\n          maxLength={255}\n          name=\"ime_artikal\"\n          // onChangeText={setFieldValue} //-DT-20210203\n          placeholder=\"Ime na Artikal\"\n          // placeholder={getImeArtikal()}\n          // setFieldValue={\"aaaa\"}\n          // setFieldValue={getImeArtikal()}\n          // value={getImeArtikal()}\n          // value={defaultValue}\n        />\n        <FormField\n          maxLength={255}\n          name=\"vid2\"\n          placeholder=\"Vid2\"\n          width=\"100%\"\n          // defaultValue={isAddMode ? \"\" : artikal.cena.toString()}\n        />\n        <FormField\n          keyboardType=\"numeric\"\n          maxLength={8}\n          name=\"cena\"\n          placeholder=\"Cena\"\n          width={120}\n          // defaultValue={isAddMode ? \"\" : artikal.cena.toString()}\n        />\n        <Picker\n          // items={vids}\n          items={vidData}\n          name=\"vid\"\n          numberOfColumns={3}\n          PickerItemComponent={CategoryPickerItem}\n          placeholder=\"Vid\"\n          // placeholder={artikal.ime_vid} //+DT-20210202\n          width=\"100%\"\n          // defaultValue={isAddMode ? \"\" : artikal.ime_vid} //+DT-20210202\n          // value={artikal.ime_vid} //+DT-20210202\n        />\n        <Text style={styles.switch}>\n          <Switch\n            style={styles.switch}\n            trackColor={{ false: \"#767577\", true: \"#81b0ff\" }}\n            thumbColor={isEnabled ? \"#f5dd4b\" : \"#f4f3f4\"}\n            ios_backgroundColor=\"#3e3e3e\"\n            onValueChange={toggleSwitch}\n            value={isEnabled}\n          />\n          Danok\n        </Text>\n        {/* <Text>aaa</Text> */}\n\n        <FormField\n          keyboardType=\"numeric\"\n          maxLength={8}\n          name=\"steuerrelevant\"\n          placeholder=\"Danok?\"\n          width={120}\n          // defaultValue={isAddMode ? \"\" : artikal.steuerrelevant.toString()}\n        />\n        <FormField\n          keyboardType=\"numeric\"\n          maxLength={10}\n          name=\"insdate\"\n          placeholder=\"Datum na vnes\"\n          width=\"100%\"\n        />\n        <SubmitButton title=\"Save\" />\n      </Form>\n    </Screen>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    padding: 10,\n  },\n  switch: {\n    backgroundColor: defaultStyles.colors.light,\n    borderRadius: 25,\n    flexDirection: \"row\",\n    padding: 15,\n    marginVertical: 10,\n    alignItems: \"stretch\",\n  },\n});\n\nexport default ArtikalEditScreen;\n"]},"metadata":{},"sourceType":"module"}